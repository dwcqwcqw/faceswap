# 多人换脸功能测试指南

## 🧪 测试步骤

### 1. 启动前端应用
```bash
cd web/frontend
npm run dev
```
访问: http://localhost:3003

### 2. 测试多人脸检测

1. **进入多人换脸页面**
   - 点击导航栏的 "Multi Image" 或访问 http://localhost:3003/multi-image

2. **上传多人图片**
   - 点击 "选择图片" 按钮
   - 上传一张包含多个人脸的图片
   - 等待人脸检测完成

3. **验证人脸检测结果**
   - 检查是否正确识别了所有人脸
   - 每个检测到的人脸应该显示一个上传框
   - 人脸应该有边界框标识

### 3. 测试多人换脸

1. **为每个检测到的人脸上传替换图片**
   - 为每个 "Face X" 上传一张包含单人脸的图片
   - 确保替换图片质量良好且人脸清晰

2. **开始处理**
   - 点击 "开始处理" 按钮
   - 观察处理进度和状态信息

3. **验证结果**
   - 检查生成的图片是否正确替换了所有指定的人脸
   - 验证图片质量和人脸融合效果

## 🔍 预期行为

### 正常情况
- ✅ 人脸检测应该在 10-30 秒内完成
- ✅ 每个检测到的人脸都应该有清晰的边界框
- ✅ 多人换脸处理应该在 1-3 分钟内完成
- ✅ 结果图片应该保持原图分辨率和质量

### 错误处理
- ⚠️ 如果没有检测到人脸，应该显示相应错误信息
- ⚠️ 如果上传的替换图片没有人脸，应该给出警告
- ⚠️ 处理超时应该有明确的错误提示

## 🐛 常见问题排查

### 人脸检测失败
1. 检查图片格式（支持 JPG, PNG）
2. 确保图片中人脸清晰可见
3. 检查图片大小（建议 < 10MB）

### 处理超时
1. 检查 RunPod 端点状态
2. 查看浏览器开发者工具的网络请求
3. 检查 Cloudflare Worker 日志

### 结果质量差
1. 使用高质量的源图片和目标图片
2. 确保人脸角度和光照相似
3. 避免使用过小或模糊的图片

## 📊 测试用例

### 测试用例 1: 双人换脸
- **目标图片**: 包含 2 个清晰人脸的图片
- **替换图片**: 2 张不同的单人脸图片
- **预期结果**: 两个人脸都被正确替换

### 测试用例 2: 多人群体照
- **目标图片**: 包含 3-5 个人脸的群体照
- **替换图片**: 对应数量的单人脸图片
- **预期结果**: 所有指定人脸被替换，未指定的保持原样

### 测试用例 3: 部分替换
- **目标图片**: 包含多个人脸
- **替换图片**: 只为部分人脸上传替换图片
- **预期结果**: 只有指定的人脸被替换

## 🔧 调试信息

### 浏览器控制台
检查以下信息：
- 人脸检测 API 响应
- 文件上传状态
- 处理进度更新
- 错误信息

### 网络请求
监控以下 API 调用：
- `/api/upload` - 文件上传
- `/api/detect-faces` - 人脸检测
- `/api/process/multi-image` - 多人换脸处理
- `/api/status/{jobId}` - 处理状态查询

## 📝 测试报告模板

```
测试时间: ___________
测试人员: ___________

人脸检测测试:
□ 单人脸图片检测正常
□ 双人脸图片检测正常  
□ 多人脸图片检测正常
□ 无人脸图片正确报错

多人换脸测试:
□ 双人换脸功能正常
□ 多人换脸功能正常
□ 部分替换功能正常
□ 结果图片质量满意

性能测试:
□ 人脸检测时间 < 30秒
□ 双人换脸时间 < 2分钟
□ 多人换脸时间 < 3分钟

错误处理:
□ 无人脸图片错误提示正确
□ 网络错误处理正常
□ 超时处理正常

总体评价: ___________
问题记录: ___________
``` 